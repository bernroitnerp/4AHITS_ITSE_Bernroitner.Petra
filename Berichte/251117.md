Petra Bernroitner, 4AHITS, 17.11.2025


# Port Probing

## Übung (nmap port scan)
Nach dem ping scan (und wenn nicht die Option -sn angegeben ist) führt nmap automatisch einen port scan auf allen gefundenen hosts aus. Dabei wird versucht alle offenen Ports eines Hosts zu finden. Das Ziel ist eine Liste der am Host laufenden Dienste zu erhalten.

Hinweise: Man kann eine einzelne IP Adresse angeben, dann wird nur diese gescannt, z.B.: nmap 192.168.178.42


*Aufgaben:*


**1. Führe einen port scan auf die Metasploitable VM durch. Analysiere das Ergebnis.**

``` nmap -p- IP_META ``` das ```-p-``` scannt alle Ports von 1 bis 65535 nmap erkennt auch die Dienste.

<img width="522" height="622" alt="image" src="https://github.com/user-attachments/assets/3ae4f2bb-3664-48b4-8564-351bc159dd74" />

hier sind nur TCP-Protokolle.


--- 

**2. Experimentiere mit den Optionen für (Victim ist Metasploitable VM):**
   
*Scannen aller möglichen Ports.*

 *Macht das bei Metasploitable, verglichen zum Default Verhalten, einen Unterschied?* 

```nmap -p- 192.168.11.51```

```
PORT      STATE SERVICE
21/tcp    open  ftp
22/tcp    open  ssh
23/tcp    open  telnet
25/tcp    open  smtp
53/tcp    open  domain
80/tcp    open  http
111/tcp   open  rpcbind
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
512/tcp   open  exec
513/tcp   open  login
514/tcp   open  shell
1099/tcp  open  rmiregistry
1524/tcp  open  ingreslock
2049/tcp  open  nfs
2121/tcp  open  ccproxy-ftp
3306/tcp  open  mysql
3632/tcp  open  distccd
5432/tcp  open  postgresql
5900/tcp  open  vnc
6000/tcp  open  X11
6667/tcp  open  irc
6697/tcp  open  ircs-u
8009/tcp  open  ajp13
8180/tcp  open  unknown
8787/tcp  open  msgsrvr
33127/tcp open  unknown
36349/tcp open  unknown
45906/tcp open  unknown
47594/tcp open  unknown
```

-> Ein Vollscan liefert meist ein paar zusätzliche offene Ports, auch wenn die wichtigsten in den Top-1000 liegen.

**Überspringen Ping-Scan/Host-Discovery. Warum kann diese Option notwendig sein?**

```
-n   (DNS auflösen aus)
-Pn  (keine Host-Discovery / keine Ping-Probes)
```

Wenn Nmap einen Host scannt, testet es davor, ob dieser online ist.
```-Pn```ist selten nötig, außer wenn der Host auf einen Ping oder Probe-Paketze nicht antwortet. Sonst würde Nmap den Scan gar nicht erst ausführen.


- **Service/Version Detection**

Mit ```-sV ``` sendet man spezielle Probes an offene Ports und dann werden die Antworten analysiert, es schat welche Version und welcher Dienst darauf läuft.
Also es liefert Informationen um Verwundbarkeiten zu identifizieren.

```
nmap -sV 192.168.11.51

Nmap scan report for 192.168.11.51
Host is up (0.0031s latency).
Not shown: 977 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
23/tcp   open  telnet      Linux telnetd
25/tcp   open  smtp        Postfix smtpd
53/tcp   open  domain      ISC BIND 9.4.2
80/tcp   open  http        Apache httpd 2.2.8 ((Ubuntu) DAV/2)
111/tcp  open  rpcbind     2 (RPC #100000)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
512/tcp  open  exec        netkit-rsh rexecd
513/tcp  open  login       OpenBSD or Solaris rlogind
514/tcp  open  tcpwrapped
1099/tcp open  java-rmi    GNU Classpath grmiregistry
1524/tcp open  bindshell   Metasploitable root shell
2049/tcp open  nfs         2-4 (RPC #100003)
2121/tcp open  ftp         ProFTPD 1.3.1
3306/tcp open  mysql       MySQL 5.0.51a-3ubuntu5
5432/tcp open  postgresql  PostgreSQL DB 8.3.0 - 8.3.7
5900/tcp open  vnc         VNC (protocol 3.3)
6000/tcp open  X11         (access denied)
6667/tcp open  irc         UnrealIRCd
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8180/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1
MAC Address: 00:0C:29:FA:DD:2A (VMware)
Service Info: Hosts:  metasploitable.localdomain, irc.Metasploitable.LAN; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
``` 


- **OS Erkennung**

Die OS-Erkennung in Nmap ```-O``` versucht anhand charakteristischer Netzwerkverhalten zu bestimmen, welches Betriebssystem auf dem Ziel läuft.

```
nmap -O 192.168.11.51
...
MAC Address: 00:0C:29:FA:DD:2A (VMware)
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6
OS details: Linux 2.6.9 - 2.6.33
Network Distance: 1 hop
```

- **Aggressive Scan**

```A``` gibt *seeeehr viele detaillierte Infos*, aber deshalb auch sehr viel traffic.
So werden Schwachstellen sichtbarer. 

Ein Aggressive Scan liefert daher sehr detaillierte Ergebnisse:

- OS: Linux 2.6.x (Ubuntu 8.04)
- Präzise Versionsinfos für Dienste wie:
    - vsFTPd 2.3.4
    - Apache 2.2.8
    - ProFTPD
    - MySQL 5.0.51a
    - Tomcat
- NSE-Skripte finden zusätzlich:
    - Anonymous FTP erlaubt
    - HTTP-Server-Informationen
    - SMB Workgroup
    - RPC-Informationen
- Traceroute zeigt oft: 1 Hop (lokales Lab)

Mit Metasploitable ist -A daher ideal, weil viele seiner verwundbaren Services nur durch Versionserkennung oder NSE-Skripte sichtbar werden.

- **Timing/Speed**

Es gibt ```T0```bis ```T5```

```
Timing	Zweck	            Vorteil	                        Nachteil
T0/T1	Stealth	            unauffällig	                    dauert extrem lange
T2	    schonend	        stabil	                        langsam
T3	    Standard	        zuverlässig	                    nicht spezialisiert
T4	    schneller Scan	    beste Speed/Qualität-Balance	leicht auffällig
T5	    maximal schnell	    sehr kurze Scan-Zeit	        viele Fehlmessungen
```
```
nmap -T4 192.168.11.51
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 06:54 EST
Nmap scan report for 192.168.11.51
Host is up (0.0054s latency).
Not shown: 977 closed tcp ports (reset)
...
Nmap done: 1 IP address (1 host up) scanned in 0.32 seconds
```


- **Ausgabe in Dateien**

```
Option	Format	        Zweck
-oN     Normal          Menschlich lesbare Ausgabe      
-oG     Grepable        Für grep/awk – Skripting        
-oX     XML             Strukturierte Verarbeitung      
-oA     Alle drei       Best practice für Dokumentation
```

ein Beispiel:
```
nmap -oN scan.txt 192.168.11.51
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:00 EST
Nmap scan report for 192.168.11.51
Host is up (0.0030s latency).
Not shown: 977 closed tcp ports (reset)
...
Nmap done: 1 IP address (1 host up) scanned in 0.31 seconds
```

- **die Option ```--reason```**

Sie zeigt den Grund für die Portklassifizierung:
    - welches Paket (z. B. SYN/ACK, RST, ICMP) zurückkam
    - welcher ICMP-Type/Code empfangen wurde
    - ob ein Timeout (keine Antwort) erfolgte
    - welches Protokoll oder Verhalten dafür verantwortlich war

```
nmap -sn --reason 192.168.11.51
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:02 EST
Nmap scan report for 192.168.11.51
Host is up, received arp-response (0.00059s latency).
MAC Address: 00:0C:29:FA:DD:2A (VMware)
Nmap done: 1 IP address (1 host up) scanned in 0.08 seconds

```
--reason zeigt, welches Paket- oder ICMP-Verhalten dazu geführt hat, dass ein Port als open, closed, filtered usw. eingestuft wurde.


- **nur die N häufigsten Ports scannen (dokumentiere den Geschwindigkeitsgewinn)**

```--top-ports```
schneller weil: Weniger Ports → weniger SYN-Pakete, weniger Antworten → weniger Wartezeit → weniger Verbindungsaufbau.

```
nmap --top-ports 100 192.168.11.51
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:06 EST
Nmap scan report for 192.168.11.51
Host is up (0.0019s latency).
Not shown: 82 closed tcp ports (reset)
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
23/tcp   open  telnet
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
513/tcp  open  login
514/tcp  open  shell
2049/tcp open  nfs
2121/tcp open  ccproxy-ftp
3306/tcp open  mysql
5432/tcp open  postgresql
5900/tcp open  vnc
6000/tcp open  X11
8009/tcp open  ajp13
MAC Address: 00:0C:29:FA:DD:2A (VMware)

Nmap done: 1 IP address (1 host up) scanned in 0.21 seconds
```


**3. Führe weitere port scans durch, auf:**

einem Kali Linux auf einem anderen Rechner

auf Sarah ihr Kali:

```
nmap 192.168.17.52                
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:08 EST
Nmap scan report for 192.168.17.52
Host is up (0.00087s latency).
All 1000 scanned ports on 192.168.17.52 are in ignored states.
Not shown: 599 filtered tcp ports (no-response), 401 closed tcp ports (reset)

Nmap done: 1 IP address (1 host up) scanned in 61.62 seconds
```




**einem Windows System**

nmap auf meine IP-Adresse 


```
nmap 192.168.11.50
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:11 EST
Nmap scan report for 192.168.11.50
Host is up (0.00028s latency).
All 1000 scanned ports on 192.168.11.50 are in ignored states.
Not shown: 1000 filtered tcp ports (no-response)
MAC Address: 60:A4:B7:75:7A:B4 (TP-Link Limited)

Nmap done: 1 IP address (1 host up) scanned in 21.27 seconds
```




**dem Default Gateway im Labor Netz**

```
nmap 192.168.11.254
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:12 EST
Nmap scan report for 192.168.11.254
Host is up (0.0015s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE
23/tcp open  telnet
MAC Address: 1C:DF:0F:CA:41:01 (Cisco Systems)

Nmap done: 1 IP address (1 host up) scanned in 3.75 seconds

nmap -A 10.200.83.1 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-11-17 07:18 EST
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 3.29 seconds
```
Die Windows Firewall lässt tendentiell nur Pings durch und keine Scans, hier sieht es aus als wären die Hosts down. 

Linux-Systeme (z. B. Metasploitable) antworten deutlich offener → besser scanbar.


---


**4. Was kann alles mit einem port scan herausgefunden werden? Dokumentiere!**


Ein Portscan kann Informationen über einen Host liefern, ohne dass man sich anmeldet oder einloggt. 

1. Welche Ports offen, geschlossen oder gefiltert sind
2. Welche Dienste laufen
    Nmap erkennt zu fast jedem offenen Port den zugehörigen Dienst:
    z. B. FTP, SSH, HTTP, MySQL, SMB, Telnet …

3. Welche Versionen diese Dienste haben (mit -sV),
    z.B. Apache 2.2.8, MySQL 5.0.51a, vsftpd 2.3.4

   → Wichtig zur Erkennung von Schwachstellen.

4. Betriebssystem-Erkennung (mit -O)
5. Firewall- und Filterverhalten
    Pakete geblockt werden, Host Ping ignoriert
6. Netzwerkstruktur-Informationen
7. Schwachstellen-Hinweise
    offene Ports, Dienste, Versionen und NSE-Skripte:

*Also:*
Ein Portscan zeigt, welche Dienste auf einem System laufen, welche Versionen sie haben, welches OS verwendet wird und wie die Firewall reagiert. Damit kann man Sicherheitslücken erkennen.

---

## Cheat Sheet

### Nmap Cheatsheet – Befehle & Optionen

| Befehl / Kürzel                  | Schreibweise / Beispiel                         | Erklärung (Kurz)                                                                 |
|----------------------------------|-------------------------------------------------|----------------------------------------------------------------------------------|
| `nmap <IP>`                      | `nmap 192.168.11.51`                           | Standardscan der 1000 häufigsten TCP-Ports                                       |
| `-p-`                            | `nmap -p- 192.168.11.51`                       | Scan aller 65.535 Ports                                                          |
| `--top-ports <N>`                | `nmap --top-ports 100 192.168.11.51`           | Scannt nur die N häufigsten Ports (schneller)                                   |
| `-sn`                            | `nmap -sn 192.168.11.51`                       | Nur Ping-Scan (Host-Discovery, kein Portscan)                                   |
| `-Pn`                            | `nmap -Pn 192.168.11.51`                       | Überspringt Host-Discovery (nützlich, wenn Pings blockiert werden)              |
| `-n`                             | `nmap -n 192.168.11.51`                        | Deaktiviert DNS-Auflösung (schneller Scan)                                      |
| `-sV`                            | `nmap -sV 192.168.11.51`                       | Erkennt Dienst- und Versionsinformationen                                       |
| `-O`                             | `nmap -O 192.168.11.51`                        | Erkennt Betriebssystem (OS Detection)                                           |
| `-A`                             | `nmap -A 192.168.11.51`                        | Aggressiver Scan: OS-, Version-, Script- und Traceroute-Infos                   |
| `-T<0–5>`                        | `nmap -T4 192.168.11.51`                       | Timing-Template: T0 langsam & stealthy → T5 sehr schnell & auffällig            |
| `--reason`                       | `nmap -sn --reason 192.168.11.51`              | Zeigt Grund für Portzustand (z. B. SYN/ACK, RST, Timeout)                       |
| `-oN <file>`                     | `nmap -oN scan.txt 192.168.11.51`              | Speichert Ausgabe im normalen, lesbaren Format                                  |
| `-oG <file>`                     | `nmap -oG scan.grep 192.168.11.51`             | Grep-fähige Ausgabe (für Skripte)                                               |
| `-oX <file>`                     | `nmap -oX scan.xml 192.168.11.51`              | XML-Ausgabe (strukturierte Weiterverarbeitung)                                  |
| `-oA <basename>`                 | `nmap -oA scan 192.168.11.51`                  | Alle Ausgabeformate gleichzeitig (`scan.nmap`, `.gnmap`, `.xml`)                |
| `-v`                             | `nmap -v 192.168.11.51`                        | Verbose-Modus – zeigt mehr Details während des Scans                            |
| `-vv`                            | `nmap -vv 192.168.11.51`                       | Noch detailliertere Ausgabe                                                     |
| `--open`                         | `nmap --open 192.168.11.51`                    | Zeigt nur offene Ports                                                          |
| `-6`                             | `nmap -6 <IPv6-Adresse>`                       | IPv6-Scan                                                                      |
| `-sS`                            | `nmap -sS 192.168.11.51`                       | TCP SYN-Scan („Half-Open“, Standardmodus)                                       |
| `-sT`                            | `nmap -sT 192.168.11.51`                       | TCP Connect-Scan (vollständiger Verbindungsaufbau)                              |
| `-sU`                            | `nmap -sU 192.168.11.51`                       | UDP-Scan                                                                       |
| `-sP` *(veraltet)*               | `nmap -sP 192.168.11.51`                       | Früherer Ping-Scan (jetzt `-sn`)                                               |
| `--script <name>`                | `nmap --script vuln 192.168.11.51`             | Führt NSE-Skripte (z. B. Schwachstellenanalyse) aus                            |
| `--traceroute`                   | `nmap --traceroute 192.168.11.51`              | Zeigt Netzwerkpfad (Routenanalyse)                                              |
| `--stats-every <t>`              | `nmap --stats-every 5s 192.168.11.51`          | Zeigt Fortschrittsstatistiken während langer Scans                             |

---

###  **Timing-Vorlagen**
| Kürzel | Name          | Beschreibung                              |
|--------|----------------|-------------------------------------------|
| T0     | Paranoid       | Sehr langsam, kaum erkennbar              |
| T1     | Sneaky         | Langsam und unauffällig                   |
| T2     | Polite         | Schonend, aber träge                      |
| T3     | Normal         | Standardgeschwindigkeit                   |
| T4     | Aggressive     | Schnell, gute Balance                     |
| T5     | Insane         | Sehr schnell, unzuverlässig               |

---

###  **Portzustände**
| Zustand    | Bedeutung                                           |
|-------------|----------------------------------------------------|
| open        | Dienst aktiv, antwortet auf Anfragen               |
| closed      | Erreichbar, aber kein Dienst aktiv                 |
| filtered    | Paket gefiltert oder blockiert (z. B. durch Firewall) |
| unfiltered  | Port erreichbar, Status unklar                     |
| open|filtered | Keine eindeutige Antwort, könnte offen oder gefiltert sein |
| closed|filtered | Unklar, ob geschlossen oder geblockt            |

---

###  **Typische Scan-Kombinationen**
| Zweck                         | Beispielbefehl                                      |
|--------------------------------|-----------------------------------------------------|
| Vollscan (alle Ports)          | `nmap -p- -sV -O 192.168.11.51`                    |
| Aggressiver Info-Scan          | `nmap -A 192.168.11.51`                            |
| Schneller Top-Port-Scan        | `nmap --top-ports 100 -T4 192.168.11.51`           |
| Host ohne Ping scannen         | `nmap -Pn -sV 192.168.11.51`                       |
| Ausgabe speichern (alle Formate) | `nmap -oA scan -A 192.168.11.51`                   |

